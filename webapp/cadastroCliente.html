<!DOCTYPE html>
<html lang="pt-br" xmlns:th="https://thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cadastro</title>
  <link rel="stylesheet" href="cadastroCliente.css" />
</head>
<body>
  <div class="container">
    <div class="imagem">
      <img src="./img/construction.png" alt="" />
      <a id="btnPrestador"><button class="prestador"> Quero ser prestador</button></a>
    </div>

    <div class="formulario">
      <form id="formCadastro">
        <h1>O serviço que você <br> procura, está aqui!</h1>

        <div class="campo-input">
          <input type="text" id="nome" name="nome" required class="input" />
          <label for="nome">
            <span class="char" style="--index:0">N</span>
            <span class="char" style="--index:1">o</span>
            <span class="char" style="--index:2">m</span>
            <span class="char" style="--index:3">e</span>
          </label>
        </div>


          <div class="campo-input">
            <input type="text" id="telefone" name="telefone" required class="input" />
            <label for="telefone">
              <span class="char" style="--index:0">T</span>
              <span class="char" style="--index:1">e</span>
              <span class="char" style="--index:2">l</span>
              <span class="char" style="--index:3">e</span>
              <span class="char" style="--index:4">f</span>
              <span class="char" style="--index:5">o</span>
              <span class="char" style="--index:6">n</span>
              <span class="char" style="--index:7">e</span>
            </label>
          </div>


        <div class="campo-input">
          <select id="estado" name="estado" required>
            <option value="">Selecione um estado</option>
          </select>
        </div>

        <div class="campo-input">
          <select id="cidade" name="cidade" required disabled class="input">
            <option value="">Selecione o estado primeiro</option>
          </select>
        </div>

        <div class="campo-input">
          <input type="text" id="endereco" name="endereco" required class="input" />
          <label for="endereco">
            <span class="char" style="--index:0">E</span>
            <span class="char" style="--index:1">n</span>
            <span class="char" style="--index:2">d</span>
            <span class="char" style="--index:3">e</span>
            <span class="char" style="--index:4">r</span>
            <span class="char" style="--index:5">e</span>
            <span class="char" style="--index:6">ç</span>
            <span class="char" style="--index:7">o</span>
          </label>
        </div>

        <div class="campo-input">
          <input type="text" id="email" name="email" required class="input" />
          <label for="email">
            <span class="char" style="--index:0">E</span>
            <span class="char" style="--index:1">-</span>
            <span class="char" style="--index:2">m</span>
            <span class="char" style="--index:3">a</span>
            <span class="char" style="--index:4">i</span>
            <span class="char" style="--index:5">l</span>
          </label>
        </div>

        <div class="campo-input">
          <input type="password" id="password" name="password" required class="input" />
          <label for="password">
            <span class="char" style="--index:0">S</span>
            <span class="char" style="--index:1">e</span>
            <span class="char" style="--index:2">n</span>
            <span class="char" style="--index:3">h</span>
            <span class="char" style="--index:4">a</span>
          </label>
        </div>
        <p>
          <input type="checkbox" required />
          <span> Li e concordo com a</span>
          <a href="#">Política de Privacidade</a> e os
          <a href="#">Termos de Uso</a>
          <br><br>
          <button type="submit">Quero me cadastrar!</button>
          <br><br>
          <span><a href="loginCliente.html">Já tenho uma conta</a></span>
        </p>
      </form>
    </div>
  </div>
</body>
  <script>
  const estadoSelect = document.getElementById('estado');
  const cidadeSelect = document.getElementById('cidade');

  // Carregar estados ao iniciar a página
  fetch('https://servicodados.ibge.gov.br/api/v1/localidades/estados')
  .then(res => res.json())
  .then(estados => {
  estados.sort((a, b) => a.nome.localeCompare(b.nome));
  estados.forEach(estado => {
    const option = document.createElement('option');
    option.value = estado.id; 
    option.textContent = estado.nome;
    estadoSelect.appendChild(option);
  });
  });

  estadoSelect.addEventListener('change', () => {
  const estadoId = estadoSelect.value;
  cidadeSelect.innerHTML = ''; 

  if (!estadoId) {
  cidadeSelect.disabled = true;
  cidadeSelect.innerHTML = '<option value="">Selecione o estado primeiro</option>';
  return;
  }

  cidadeSelect.disabled = false;

  fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`)
  .then(res => res.json())
  .then(cidades => {
    cidades.forEach(cidade => {
      const option = document.createElement('option');
      option.value = cidade.id;
      option.textContent = cidade.nome;
      cidadeSelect.appendChild(option);
    });
  });
  });

    document.getElementById("btnPrestador").addEventListener("click", function(e) {
      e.preventDefault(); 
      document.body.classList.add("slide-out");

      setTimeout(() => {
        window.location.href = "cadastroPrestador.html";
      }, 300);
    });
    document.getElementById('estado').addEventListener('change', function() {
      const estadoSelecionado = this.value;
      const cidadeSelect = document.getElementById('cidade');
      cidadeSelect.innerHTML = '';

      if (estadoSelecionado && cidadesPorEstado[estadoSelecionado]) {
        cidadeSelect.disabled = false;
        const optionPadrao = document.createElement('option');
        optionPadrao.value = '';
        optionPadrao.textContent = 'Selecione uma cidade';
        cidadeSelect.appendChild(optionPadrao);

        cidadesPorEstado[estadoSelecionado].forEach(cidade => {
          const option = document.createElement('option');
          option.value = cidade;
          option.textContent = cidade;
          cidadeSelect.appendChild(option);
        });
      } else {
        cidadeSelect.disabled = true;
        const optionPadrao = document.createElement('option');
        optionPadrao.value = '';
        optionPadrao.textContent = 'Selecione o estado primeiro';
        cidadeSelect.appendChild(optionPadrao);
      }
    });

    document.getElementById('formCadastro').addEventListener('submit', async function(e) {
  e.preventDefault();

  const estadoId = this.estado.value;
  const cidadeId = this.cidade.value;

  try {
    const estadoRes = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}`);
    const estadoDados = await estadoRes.json();
    const nomeEstado = estadoDados.nome;

    const cidadeRes = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/municipios/${cidadeId}`);
    const cidadeDados = await cidadeRes.json();
    const nomeCidade = cidadeDados.nome;

    const dados = {
      nome: this.nome.value,
      telefone: this.telefone.value,
      estado: nomeEstado, 
      cidade: nomeCidade,
      endereco: this.endereco.value,
      email: this.email.value,
      password: this.password.value,
    };

    const res = await fetch('http://localhost:3000/salvarClientes', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(dados),
    });

    const data = await res.json();
    alert(data.mensagem || 'Cadastro realizado com sucesso!');
    window.location.href = "loginCliente.html";
  } catch (error) {
    alert('Erro ao cadastrar: ' + error.message);
  }
  });

  </script>
</html>
